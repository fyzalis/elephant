$(document).ready(function(){!function(t){t.fn.elephant=function(e){function n(){f=c(localStorage.getItem("elephant"))}function a(){x(),g.active&&(g.time++,D())}function r(){1==g.favorite?(g.favorite=0,D()):(g.favorite=1,S(!0))}function i(t,e){e||(e="DEBUG"),console.log(e,t)}function o(t){return JSON.stringify(t)}function c(t){return jQuery.parseJSON(t)}var l=t.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5},e),u=window.location.pathname,s={page:u,text:"",image:""},f=new Array,g={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},h={time:1,scroll:1,visit:10,trigger:10},p=new Array,d=!1,m=function(){return null!=localStorage.getItem("elephant")},v=function(){localStorage.setItem("elephant",o(f))},y=function(t){return c(localStorage.getItem("elephant::"+t))},w=function(t){for(var e in t)t.hasOwnProperty(e)&&(g[e]="updated_at"!=e?t[e]:new Date(t[e]))},D=function(){R(),localStorage.setItem("elephant::"+u,o(g))},I=function(){S(!0),g.trigger+=1,D()},S=function(t){t&&(g.updated_at=new Date),g.active=t,D()},A=function(){t("#elephanto li.first").on("click",function(){d=!0,t("#elephanto li.not-first").toggle()})},x=function(){var t=new Date,e=g.updated_at.getTime()/1e3,n=t.getTime()/1e3;Math.round(n-e)>l.activeDuration&&1==g.active&&S(!1)},M=function(){i(l.maxDisplayedResult,"MAX DISPLAYED");var e="",n=0;e+="<ul class='elephanto'>",t.each(p,function(t,a){if(!(n<l.maxDisplayedResult))return!1;var r=c(localStorage.getItem("elephanto::"+a)),i=c(localStorage.getItem("elephant::"+a)),o="";o=0==n?"first":0==d?"not-first":"",e+="<li data-score='"+i.score+"' data-position='"+n+"' data-favorite='"+i.favorite+"' class='"+o+"'>",r.image&&(e+="<a href='"+r.page+"'>",e+="<img src='"+r.image+"' />",e+="</a>"),r.text&&(e+="<a href='"+r.page+"'>",e+=r.text,e+="</a>"),i.favorite&&(e+="<img src='/star-icon.png' />"),e+="</li>",n++}),e+="</ul>",t("#elephanto").html(e)},R=function(){var t=0;t+=Math.round(g.time*h.time),t+=Math.round(g.visit*h.visit),t+=Math.round(g.trigger*h.trigger),t+=Math.round(g.scroll*h.scroll),g.score=t,_()},_=function(){var e=(new Array,new Array),n=new Array,a=0;t.each(f,function(t,a){var r=new Array;r.page=a,r.stats=y(f[t]),r.stats.favorite?e.push(r):n.push(r)}),e.sort(function(t,e){return e.stats.score-t.stats.score}),n.sort(function(t,e){return e.stats.score-t.stats.score}),t.each(e,function(t,e){p[a]=e.page,a++}),t.each(n,function(t,e){p[a]=e.page,a++})};if(function(){return!!t("div#elephant").length}()&&(m()||v(),n(),function(){return-1!==jQuery.inArray(u,f)}()||function(){f.push(u),localStorage.setItem("elephant",o(f)),localStorage.setItem("elephant::"+u,o(g)),s.text=t("#elephant").data("text"),s.image=t("#elephant").data("image"),localStorage.setItem("elephanto::"+u,o(s))}(),function(){var t=c(localStorage.getItem("elephant::"+u));w(t)}(),setInterval(function(){a()},1e3),function(){t(window).scroll(function(t){S(!0),g.scroll+=1,D()})}(),function(){g.visit+=1,S(!0),D()}(),function(){t.each(l.triggers,function(e,n){t(n).on("click",function(){I()})})}(),function(){t("#elephantAdd").on("click",function(){r(),D()})}()),function(){return!!t("div#elephanto").length}()){m()||v(),n();setInterval(function(){_(),M(),A()},1e3*l.refreshRender)}}}(jQuery)}),$(document).ready(function(){$.fn.elephant({triggers:new Array(".trigger1",".trigger2"),activeDuration:5,maxDisplayedResult:3})});