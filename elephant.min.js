$(document).ready(function(){!function(t){t.fn.elephant=function(e){function n(){s=o(localStorage.getItem("elephant"))}function a(){x(),f.active&&(f.time++,w())}function r(){1==f.favorite?(f.favorite=0,w()):(f.favorite=1,S(!0))}function i(t){return JSON.stringify(t)}function o(t){return jQuery.parseJSON(t)}var c=t.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5},e),l=window.location.pathname,u={page:l,text:"",image:""},s=new Array,f={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},g={time:1,scroll:1,visit:10,trigger:10},p=new Array,h=!1,d=function(){return null!=localStorage.getItem("elephant")},v=function(){localStorage.setItem("elephant",i(s))},m=function(t){return o(localStorage.getItem("elephant::"+t))},y=function(t){for(var e in t)t.hasOwnProperty(e)&&(f[e]="updated_at"!=e?t[e]:new Date(t[e]))},w=function(){M(),localStorage.setItem("elephant::"+l,i(f))},I=function(){S(!0),f.trigger+=1,w()},S=function(t){t&&(f.updated_at=new Date),f.active=t,w()},A=function(){t("#elephanto div.open").on("click",function(){h=!0,t("#elephanto li.not-first").toggle(),t("#elephanto div.open").toggle(),t("#elephanto li.first").css("padding-top","10px")})},x=function(){var t=new Date,e=f.updated_at.getTime()/1e3,n=t.getTime()/1e3;Math.round(n-e)>c.activeDuration&&1==f.active&&S(!1)},D=function(){if(p.length>0){var e="",n=0;e+="<div class='open'>&uarr;</div>",e+="<ul>",t.each(p,function(t,a){if(!(n<c.maxDisplayedResult))return!1;var r=o(localStorage.getItem("elephanto::"+a)),i=o(localStorage.getItem("elephant::"+a)),l="";0==n?l="first":0==h&&(l="not-first"),e+="<li data-score='"+i.score+"' data-position='"+n+"' data-favorite='"+i.favorite+"' class='"+l+"'>",r.image&&(e+="<a href='"+r.page+"'>",e+="<img src='"+r.image+"' />",e+="</a>"),r.text&&(e+="<a href='"+r.page+"'>",e+=r.text,e+="</a>"),i.favorite&&(e+="<span class='favorite'>&starf;</span>"),e+="</li>",n++}),e+="</ul>",t("#elephanto").html(e)}},M=function(){var t=0;t+=Math.round(f.time*g.time),t+=Math.round(f.visit*g.visit),t+=Math.round(f.trigger*g.trigger),t+=Math.round(f.scroll*g.scroll),f.score=t,R()},R=function(){var e=(new Array,new Array),n=new Array,a=0;t.each(s,function(t,a){var r=new Array;r.page=a,r.stats=m(s[t]),r.stats.favorite?e.push(r):n.push(r)}),e.sort(function(t,e){return e.stats.score-t.stats.score}),n.sort(function(t,e){return e.stats.score-t.stats.score}),t.each(e,function(t,e){p[a]=e.page,a++}),t.each(n,function(t,e){p[a]=e.page,a++})};if(function(){return!!t("div#elephant").length}()&&(d()||v(),n(),function(){return-1!==jQuery.inArray(l,s)}()||function(){s.push(l),localStorage.setItem("elephant",i(s)),localStorage.setItem("elephant::"+l,i(f)),u.text=t("#elephant").data("text"),u.image=t("#elephant").data("image"),localStorage.setItem("elephanto::"+l,i(u))}(),function(){var t=o(localStorage.getItem("elephant::"+l));y(t)}(),setInterval(function(){a()},1e3),function(){t(window).scroll(function(t){S(!0),f.scroll+=1,w()})}(),function(){f.visit+=1,S(!0),w()}(),function(){t.each(c.triggers,function(e,n){t(n).on("click",function(){I()})})}(),function(){t("#elephantAdd").on("click",function(){r(),w()})}()),function(){return!!t("div#elephanto").length}()){d()||v(),n(),R(),D(),A();setInterval(function(){n(),R(),D(),A()},1e3*c.refreshRender)}}}(jQuery)}),$(document).ready(function(){$.fn.elephant({triggers:new Array(".trigger1",".trigger2"),activeDuration:5})});