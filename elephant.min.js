$(document).ready(function(){!function(e){e.fn.elephant=function(t){function a(){f=r(localStorage.getItem("elephant"))}function n(){k(),p.active&&(p.time++,I())}function o(){1==p.favorite?(p.favorite=0,I()):(p.favorite=1,S(!0)),O()}function i(e){return JSON.stringify(e)}function r(e){return jQuery.parseJSON(e)}var l=e.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5,moreText:"Vos pages favorites",favoriteTrigger:"#elephant_favorite",favoriteIcon:"&hearts;",favoriteOffText:"Cette page m'intéresse",favoriteOnText:"Cette page ne m'intéresse plus",path:"",theme:"default"},t),s=window.location.pathname,c={page:s,text:"",image:""},f=new Array,p={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},u={time:1,scroll:1,visit:10,trigger:10},h=new Array,v=!1,g=!0,d=!1,m=function(){return null!=localStorage.getItem("elephant")},_=function(){localStorage.setItem("elephant",i(f))},y=function(e){return r(localStorage.getItem("elephant::"+e))},x=function(e){for(var t in e)e.hasOwnProperty(t)&&(p[t]="updated_at"!=t?e[t]:new Date(e[t]))},I=function(){M(),localStorage.setItem("elephant::"+s,i(p))},w=function(){S(!0),p.trigger+=1,I()},S=function(e){e&&(p.updated_at=new Date),p.active=e,I()},T=function(){e("#elephanto div.open").off(),e("#elephanto div.open").on("click",function(){d=!d,C()})},D=function(){e("#elephanto span.exit").off(),e("#elephanto span.exit").on("click",function(){e("#elephanto").toggle(),clearInterval(J)})},A=function(){e("#elephanto ul li").off("click"),e("#elephanto ul li").on("click",function(){location.href=e(this).data("url")})},k=function(){var e=new Date,t=p.updated_at.getTime()/1e3,a=e.getTime()/1e3;Math.round(a-t)>l.activeDuration&&1==p.active&&S(!1)},O=function(){p.favorite?(e("#elephant_favorite_off").removeClass("active"),e("#elephant_favorite_on").addClass("active")):(e("#elephant_favorite_off").addClass("active"),e("#elephant_favorite_on").removeClass("active"))},C=function(){d?(e("#elephanto span.symbol").html("&#8615;"),e("#elephanto li:not(.first)").fadeToggle("slow","swing")):(e("#elephanto span.symbol").html("&#8613;"),e("#elephanto li:not(.first)").toggle())},R=function(){if(h.length>0&&(v||g)){var t="",a=0,n=d?"&#8615;":"&#8613",o=h.length>l.maxDisplayedResult?l.maxDisplayedResult:h.length;g=!1,v=!1,t+="<div class='open'><span class='symbol'>"+n+"</span> <span class='text'>"+l.moreText+" ("+o+")</span><span class='exit'>&#10006;</span></div>",t+="<ul>",e.each(h,function(e,n){if(!(a<l.maxDisplayedResult))return!1;var o=r(localStorage.getItem("elephanto::"+n)),i=r(localStorage.getItem("elephant::"+n)),s=0==a?"first":"";t+="<li data-score='"+i.score+"' data-position='"+a+"' data-favorite='"+i.favorite+"' data-url='"+o.page+"' class='"+s+"'>",o.image&&(t+="<img src='"+o.image+"' />"),o.text&&(t+="<span class='text'>"+o.text+"</span>"),i.favorite&&(t+="<span class='elephant_favorite_on'>"+l.favoriteIcon+"</span>"),t+="</li>",a++}),t+="</ul>",e("#elephanto").html(t),d&&C(),A(),T(),D()}},M=function(){var e=0;e+=Math.round(p.time*u.time),e+=Math.round(p.visit*u.visit),e+=Math.round(p.trigger*u.trigger),e+=Math.round(p.scroll*u.scroll),p.score=e,b()},b=function(){var t=Q(),a=(new Array,new Array),n=new Array,o=0;e.each(f,function(e,t){var o=new Array;o.page=t,o.stats=y(f[e]),o.stats.favorite?a.push(o):n.push(o)}),a.sort(function(e,t){return t.stats.score-e.stats.score}),n.sort(function(e,t){return t.stats.score-e.stats.score}),e.each(a,function(e,t){h[o]=t.page,o++}),e.each(n,function(e,t){h[o]=t.page,o++}),e.each(h,function(e,a){h[e]!==t[e]&&(v=!0)}),j()},j=function(){localStorage.setItem("elephant_position_list",i(h))},Q=function(){return r(localStorage.getItem("elephant_position_list"))};if(function(){return!!e("div#elephant").length}()&&(m()||_(),a(),function(){return-1!==jQuery.inArray(s,f)}()||function(){f.push(s),localStorage.setItem("elephant",i(f)),localStorage.setItem("elephant::"+s,i(p)),c.text=e("#elephant").data("text"),c.image=e("#elephant").data("image"),localStorage.setItem("elephanto::"+s,i(c))}(),function(){var e=r(localStorage.getItem("elephant::"+s));x(e)}(),function(){if(e(l.favoriteTrigger).length>0){var t="",a="",n="";p.favorite?n="active":a="active",t+="<div id='elephant_favorite_off' class='"+a+"'>",t+="<span class='elephant_favorite_off'>"+l.favoriteIcon+"</span>",t+="<span>"+l.favoriteOffText+"</span>",t+="</div>",t+="<div id='elephant_favorite_on' class='"+n+"'>",t+="<span class='elephant_favorite_on'>"+l.favoriteIcon+"</span>",t+="<span>"+l.favoriteOnText+"</span>",t+="</div>",e("#elephant_favorite").html(t)}}(),setInterval(function(){n()},1e3),function(){e(window).scroll(function(e){S(!0),p.scroll+=1,I()})}(),function(){p.visit+=1,S(!0),I()}(),function(){e.each(l.triggers,function(t,a){e(a).on("click",function(){w()})})}(),function(){e(l.favoriteTrigger).on("click",function(){g=!0,o(),I()})}()),function(){return!!e("div#elephanto").length}()){m()||_(),function(){"default"!=l.theme&&e("head").append(e("<link rel='stylesheet' href='"+l.path+"/themes/"+l.theme+"/"+l.theme+".min.css' type='text/css' media='screen' />"))}(),a(),b(),R();var J=setInterval(function(){a(),b(),R()},1e3*l.refreshRender)}}}(jQuery)});