$(document).ready(function(){!function(t){t.fn.elephant=function(e){function n(){u=i(localStorage.getItem("elephant"))}function a(){k(),f.active&&(f.time++,x())}function o(){1==f.favorite?(f.favorite=0,x()):(f.favorite=1,I(!0))}function r(t){return JSON.stringify(t)}function i(t){return jQuery.parseJSON(t)}var c=t.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5,moreText:"Vos pages favorites"},e),l=window.location.pathname,s={page:l,text:"",image:""},u=new Array,f={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},p={time:1,scroll:1,visit:10,trigger:10},g=new Array,h=!1,v=function(){return null!=localStorage.getItem("elephant")},d=function(){localStorage.setItem("elephant",r(u))},m=function(t){return i(localStorage.getItem("elephant::"+t))},w=function(t){for(var e in t)t.hasOwnProperty(e)&&(f[e]="updated_at"!=e?t[e]:new Date(t[e]))},x=function(){T(),localStorage.setItem("elephant::"+l,r(f))},y=function(){I(!0),f.trigger+=1,x()},I=function(t){t&&(f.updated_at=new Date),f.active=t,x()},S=function(){t("#elephanto div.open").on("click",function(){h=!0,t("#elephanto li.not-first").toggle()})},A=function(){t("#elephanto div.close").on("click",function(){h=!1,t("#elephanto li.other").toggle()})},D=function(){t("#elephanto span.exit").on("click",function(){t("#elephanto").toggle(),clearInterval(_)})},k=function(){var t=new Date,e=f.updated_at.getTime()/1e3,n=t.getTime()/1e3;Math.round(n-e)>c.activeDuration&&1==f.active&&I(!1)},M=function(){if(g.length>0){var e="",n=0;e+=h?"<div class='close'>&#8615; <span class='text'>"+c.moreText+"</span><span class='exit'>&#10006;</span></div>":"<div class='open'>&#8613; <span class='text'>"+c.moreText+"</span><span class='exit'>&#10006;</span></div>",e+="<ul>",t.each(g,function(t,a){if(!(n<c.maxDisplayedResult))return!1;var o=i(localStorage.getItem("elephanto::"+a)),r=i(localStorage.getItem("elephant::"+a)),l="other";0==n?l="first":0==h&&(l="not-first"),e+="<li data-score='"+r.score+"' data-position='"+n+"' data-favorite='"+r.favorite+"' class='"+l+"'>",o.image&&(e+="<a href='"+o.page+"'>",e+="<img src='"+o.image+"' />",e+="</a>"),o.text&&(e+="<a href='"+o.page+"'>",e+=o.text,e+="</a>"),r.favorite&&(e+="<span class='favorite'>&starf;</span>"),e+="</li>",n++}),e+="</ul>",t("#elephanto").html(e)}},T=function(){var t=0;t+=Math.round(f.time*p.time),t+=Math.round(f.visit*p.visit),t+=Math.round(f.trigger*p.trigger),t+=Math.round(f.scroll*p.scroll),f.score=t,R()},R=function(){var e=(new Array,new Array),n=new Array,a=0;t.each(u,function(t,a){var o=new Array;o.page=a,o.stats=m(u[t]),o.stats.favorite?e.push(o):n.push(o)}),e.sort(function(t,e){return e.stats.score-t.stats.score}),n.sort(function(t,e){return e.stats.score-t.stats.score}),t.each(e,function(t,e){g[a]=e.page,a++}),t.each(n,function(t,e){g[a]=e.page,a++})};if(function(){return!!t("div#elephant").length}()&&(v()||d(),n(),function(){return-1!==jQuery.inArray(l,u)}()||function(){u.push(l),localStorage.setItem("elephant",r(u)),localStorage.setItem("elephant::"+l,r(f)),s.text=t("#elephant").data("text"),s.image=t("#elephant").data("image"),localStorage.setItem("elephanto::"+l,r(s))}(),function(){var t=i(localStorage.getItem("elephant::"+l));w(t)}(),setInterval(function(){a()},1e3),function(){t(window).scroll(function(t){I(!0),f.scroll+=1,x()})}(),function(){f.visit+=1,I(!0),x()}(),function(){t.each(c.triggers,function(e,n){t(n).on("click",function(){y()})})}(),function(){t("#elephantAdd").on("click",function(){o(),x()})}()),function(){return!!t("div#elephanto").length}()){v()||d(),n(),R(),M(),S(),A(),D();var _=setInterval(function(){n(),R(),M(),S(),A(),D()},1e3*c.refreshRender)}}}(jQuery)});