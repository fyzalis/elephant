$(document).ready(function(){!function(e){e.fn.elephant=function(t){function n(){p=l(localStorage.getItem("elephant"))}function i(){R(),r.active&&(r.time++,I())}function a(){1==r.favorite?(r.favorite=0,I()):(r.favorite=1,b(!0)),M()}function o(e){return JSON.stringify(e)}function l(e){return jQuery.parseJSON(e)}var s=e.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5,title:"My selection",entryName:{one:"",several:""},favoriteTrigger:"#elephant_favorite",favoriteOffText:"Add to my selection",favoriteOnText:"Remove to my selection",path:"",theme:"default",pluginInformation:"Selection made based on your browsing on the site."},t),r={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},c={time:1,scroll:1,visit:10,trigger:10},v=new Array,f=!1,d=!0,p=new Array,h="visible",u=window.location.pathname,g=s.path+"/themes/"+s.theme,m={page:u,text:"",image:""},y=function(){return null!=localStorage.getItem("elephant")},_=function(){localStorage.setItem("elephant",o(p)),localStorage.setItem("elephant_view",h)},w=function(e){return l(localStorage.getItem("elephant::"+e))},x=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]="updated_at"!=t?e[t]:new Date(e[t]))},I=function(){j(),localStorage.setItem("elephant::"+u,o(r))},S=function(e){var t=0;t=p.indexOf(e),t>-1&&p.splice(t,1),localStorage.setItem("elephant",o(p)),localStorage.removeItem("elephant::"+e),localStorage.removeItem("elephanto::"+e),lastPostionList=E(),t=lastPostionList.indexOf(e),t>-1&&lastPostionList.splice(t,1),Q(),d=!0,L(),C()},k=function(){b(!0),r.trigger+=1,I()},b=function(e){e&&(r.updated_at=new Date),r.active=e,I()},A=function(){e("#elephanto div.open").off(),e("#elephanto div.open").on("click",function(){N()})},D=function(){e("#elephanto div.list div.entry div.text").off("click"),e("#elephanto div.list div.entry div.text").on("click",function(){location.href=e(this).data("url")})},O=function(){e("#elephanto div.list div.entry div.remove img").off("click"),e("#elephanto div.list div.entry div.remove img").on("click",function(){S(e(this).data("entry"))})},T=function(){e("#elephanto div.info img.info").off("click"),e("#elephanto div.info img.info").on("click",function(){alert(s.pluginInformation)})},R=function(){var e=new Date,t=r.updated_at.getTime()/1e3,n=e.getTime()/1e3;Math.round(n-t)>s.activeDuration&&1==r.active&&b(!1)},M=function(){r.favorite?(e("#elephant_favorite_off").removeClass("active"),e("#elephant_favorite_on").addClass("active")):(e("#elephant_favorite_off").addClass("active"),e("#elephant_favorite_on").removeClass("active"))},N=function(){"visible"==h||"reduce"==h?(e("#elephanto div.open div.switch_view img.expand").css("display","none"),e("#elephanto div.open div.switch_view img.reduce").css("display","block"),e("#elephanto div.list").css("display","block"),e("#elephanto div.list div.entry").css("display","flex"),e("#elephanto div.info").css("display","block"),h="expand"):"expand"==h&&(e("#elephanto div.open div.switch_view img.expand").css("display","block"),e("#elephanto div.open div.switch_view img.reduce").css("display","none"),e("#elephanto div.list").toggle(),e("#elephanto div.info").css("display","none"),h="reduce"),localStorage.setItem("elephant_view",h)},C=function(){if(v.length>0&&(f||d)){var t="",n=0,i=v.length>s.maxDisplayedResult?s.maxDisplayedResult:v.length,a=i>1?s.entryName.several:s.entryName.one,o="",r="",c="",p="";d=!1,f=!1,t+="<div class='open'>",t+="<div class='logo'><img src='"+g+"/logo.png' /></div>",t+="<div class='text'>"+s.title+"<span class='count'>"+i+a+"</span></div>",t+="<div class='switch_view'>",t+="<img class='expand' src='"+g+"/open.png' />",t+="<img class='reduce' src='"+g+"/reduce.png' />",t+="</div>",t+="</div>",t+="<div class='list'>",e.each(v,function(e,i){if(!(n<s.maxDisplayedResult))return!1;o=l(localStorage.getItem("elephanto::"+i)),r=l(localStorage.getItem("elephant::"+i)),c=0==n?"first":"",p=r.favorite?g+"/favorite-on.png":g+"/favorite-off.png",t+="<div class='entry "+c+"' data-score='"+r.score+"' data-position='"+n+"' data-favorite='"+r.favorite+"'>",t+="<div class='favorite'><img src='"+p+"' /></div>",o.image&&(t+="<div class='image'><img src='"+o.image+"'  /></div>"),o.text&&(t+="<div class='text' data-url='"+o.page+"'>"+o.text+"</div>"),t+="<div class='remove'><img src='"+g+"/remove.png' data-entry='"+i+"' /></div>",t+="</div>",n++}),t+="</div>",t+="<div class='info'>",t+="<img class='info' src='"+g+"/info.png'>",t+="</div>",e("#elephanto").html(t),D(),A(),O(),T(),P()}0==v.length&&e("#elephanto").html("")},P=function(){h=localStorage.getItem("elephant_view"),"reduce"==h?(e("#elephanto div.list").css("display","none"),e("#elephanto div.info").css("display","none")):"expand"==h&&(e("#elephanto div.list").css("display","block"),e("#elephanto div.list div.entry").css("display","flex"),e("#elephanto div.info").css("display","block"))},j=function(){var e=0;e+=Math.round(r.time*c.time),e+=Math.round(r.visit*c.visit),e+=Math.round(r.trigger*c.trigger),e+=Math.round(r.scroll*c.scroll),r.score=e,L()},L=function(){var t=E(),n=(new Array,new Array),i=new Array;v=new Array;var a=0;e.each(p,function(e,t){var a=new Array;a.page=t,a.stats=w(p[e]),a.stats.favorite?n.push(a):i.push(a)}),n.sort(function(e,t){return t.stats.score-e.stats.score}),i.sort(function(e,t){return t.stats.score-e.stats.score}),e.each(n,function(e,t){v[a]=t.page,a++}),e.each(i,function(e,t){v[a]=t.page,a++}),e.each(v,function(e,n){v[e]!==t[e]&&(f=!0)}),Q()},Q=function(){localStorage.setItem("elephant_position_list",o(v))},E=function(){return l(localStorage.getItem("elephant_position_list"))};if(""==s.path)return console.error("You must define your Elephant directory path. Elephant not running..."),!1;if(function(){return!!e("div#elephant").length}()&&(y()||_(),n(),function(){return-1!==jQuery.inArray(u,p)}()||function(){p.push(u),localStorage.setItem("elephant",o(p)),localStorage.setItem("elephant::"+u,o(r)),m.text=e("#elephant").data("text"),m.image=e("#elephant").data("image"),localStorage.setItem("elephanto::"+u,o(m))}(),function(){var e=l(localStorage.getItem("elephant::"+u));x(e)}(),function(){if(e(s.favoriteTrigger).length>0){var t="",n="",i="";r.favorite?i="active":n="active",t+="<div id='elephant_favorite_off' class='"+n+"'>",t+="<span class='elephant_favorite_off'><img src='"+g+"/favorite-off.png' /></span>",t+="<span class='text'>"+s.favoriteOffText+"</span>",t+="</div>",t+="<div id='elephant_favorite_on' class='"+i+"'>",t+="<span class='elephant_favorite_on'><img src='"+g+"/favorite-on.png' /></span>",t+="<span class='text'>"+s.favoriteOnText+"</span>",t+="</div>",e("#elephant_favorite").html(t)}}(),setInterval(function(){i()},1e3),function(){e(window).scroll(function(e){b(!0),r.scroll+=1,I()})}(),function(){r.visit+=1,b(!0),I()}(),function(){e.each(s.triggers,function(t,n){e(n).on("click",function(){k()})})}(),function(){e(s.favoriteTrigger).on("click",function(){d=!0,a(),I()})}()),function(){return!!e("div#elephanto").length}()){y()||_(),function(){e("head").append(e("<link rel='stylesheet' href='"+s.path+"/themes/"+s.theme+"/"+s.theme+".min.css' type='text/css' media='screen' />"))}(),n(),L(),C();setInterval(function(){n(),L(),C()},1e3*s.refreshRender)}}}(jQuery)});