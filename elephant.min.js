$(document).ready(function(){!function(e){e.fn.elephant=function(t){function a(){f=r(localStorage.getItem("elephant"))}function n(){A(),u.active&&(u.time++,x())}function o(){1==u.favorite?(u.favorite=0,x()):(u.favorite=1,w(!0)),D()}function i(e){return JSON.stringify(e)}function r(e){return jQuery.parseJSON(e)}var c=e.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5,moreText:"Vos pages favorites",favoriteTrigger:"#elephant_favorite",favoriteIcon:"&hearts;",favoriteOffText:"Cette page m'intéresse",favoriteOnText:"Cette page ne m'intéresse plus"},t),s=window.location.pathname,l={page:s,text:"",image:""},f=new Array,u={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},p={time:1,scroll:1,visit:10,trigger:10},v=new Array,g=!1,h=function(){return null!=localStorage.getItem("elephant")},d=function(){localStorage.setItem("elephant",i(f))},m=function(e){return r(localStorage.getItem("elephant::"+e))},_=function(e){for(var t in e)e.hasOwnProperty(t)&&(u[t]="updated_at"!=t?e[t]:new Date(e[t]))},x=function(){C(),localStorage.setItem("elephant::"+s,i(u))},I=function(){w(!0),u.trigger+=1,x()},w=function(e){e&&(u.updated_at=new Date),u.active=e,x()},y=function(){e("#elephanto div.open").on("click",function(){g=!0,e("#elephanto li.not-first").toggle()})},S=function(){e("#elephanto div.close").on("click",function(){g=!1,e("#elephanto li.other").toggle()})},T=function(){e("#elephanto span.exit").on("click",function(){e("#elephanto").toggle(),clearInterval(M)})},A=function(){var e=new Date,t=u.updated_at.getTime()/1e3,a=e.getTime()/1e3;Math.round(a-t)>c.activeDuration&&1==u.active&&w(!1)},D=function(){u.favorite?(e("#elephant_favorite_off").removeClass("active"),e("#elephant_favorite_on").addClass("active")):(e("#elephant_favorite_off").addClass("active"),e("#elephant_favorite_on").removeClass("active"))},O=function(){if(v.length>0){var t="",a=0;t+=g?"<div class='close'>&#8615; <span class='text'>"+c.moreText+"</span><span class='exit'>&#10006;</span></div>":"<div class='open'>&#8613; <span class='text'>"+c.moreText+"</span><span class='exit'>&#10006;</span></div>",t+="<ul>",e.each(v,function(e,n){if(!(a<c.maxDisplayedResult))return!1;var o=r(localStorage.getItem("elephanto::"+n)),i=r(localStorage.getItem("elephant::"+n)),s="other";0==a?s="first":0==g&&(s="not-first"),t+="<li data-score='"+i.score+"' data-position='"+a+"' data-favorite='"+i.favorite+"' class='"+s+"'>",o.image&&(t+="<a href='"+o.page+"'>",t+="<img src='"+o.image+"' />",t+="</a>"),o.text&&(t+="<a href='"+o.page+"'>",t+=o.text,t+="</a>"),i.favorite&&(t+="<span class='elephant_favorite_on'>"+c.favoriteIcon+"</span>"),t+="</li>",a++}),t+="</ul>",e("#elephanto").html(t)}},C=function(){var e=0;e+=Math.round(u.time*p.time),e+=Math.round(u.visit*p.visit),e+=Math.round(u.trigger*p.trigger),e+=Math.round(u.scroll*p.scroll),u.score=e,k()},k=function(){var t=(new Array,new Array),a=new Array,n=0;e.each(f,function(e,n){var o=new Array;o.page=n,o.stats=m(f[e]),o.stats.favorite?t.push(o):a.push(o)}),t.sort(function(e,t){return t.stats.score-e.stats.score}),a.sort(function(e,t){return t.stats.score-e.stats.score}),e.each(t,function(e,t){v[n]=t.page,n++}),e.each(a,function(e,t){v[n]=t.page,n++})};if(function(){return!!e("div#elephant").length}()&&(h()||d(),a(),function(){return-1!==jQuery.inArray(s,f)}()||function(){f.push(s),localStorage.setItem("elephant",i(f)),localStorage.setItem("elephant::"+s,i(u)),l.text=e("#elephant").data("text"),l.image=e("#elephant").data("image"),localStorage.setItem("elephanto::"+s,i(l))}(),function(){var e=r(localStorage.getItem("elephant::"+s));_(e)}(),function(){if(e("#elephant_favorite").length>0){var t,a,n="";u.favorite?n="active":a="active",t+="<div id='elephant_favorite_off' class='"+a+"'>",t+="<span class='elephant_favorite_off'>"+c.favoriteIcon+"</span>",t+="<span>"+c.favoriteOffText+"</span>",t+="</div>",t+="<div id='elephant_favorite_on' class='"+n+"'>",t+="<span class='elephant_favorite_on'>"+c.favoriteIcon+"</span>",t+="<span>"+c.favoriteOnText+"</span>",t+="</div>",e("#elephant_favorite").html(t)}}(),setInterval(function(){n()},1e3),function(){e(window).scroll(function(e){w(!0),u.scroll+=1,x()})}(),function(){u.visit+=1,w(!0),x()}(),function(){e.each(c.triggers,function(t,a){e(a).on("click",function(){I()})})}(),function(){e(c.favoriteTrigger).on("click",function(){o(),x()})}()),function(){return!!e("div#elephanto").length}()){h()||d(),a(),k(),O(),y(),S(),T();var M=setInterval(function(){a(),k(),O(),y(),S(),T()},1e3*c.refreshRender)}}}(jQuery)});