$(document).ready(function(){!function(e){e.fn.elephant=function(t){function n(){v=r(localStorage.getItem("elephant"))}function a(){M(),p.active&&(p.time++,S())}function i(){1==p.favorite?(p.favorite=0,S()):(p.favorite=1,D(!0)),N()}function o(e){return JSON.stringify(e)}function r(e){return jQuery.parseJSON(e)}var l=e.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5,title:"Favoris",entryName:{one:"page",several:"pages"},favoriteTrigger:"#elephant_favorite",favoriteOffText:"Add to favorites",favoriteOnText:"Remove from favorites",path:"",theme:"default"},t),s=window.location.pathname,c=l.path+"/themes/"+l.theme,f={page:s,text:"",image:""},v=new Array,p={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},u={time:1,scroll:1,visit:10,trigger:10},h=new Array,d=!1,g=!0,m=!1,y=function(){return null!=localStorage.getItem("elephant")},_=function(){localStorage.setItem("elephant",o(v))},x=function(e){return r(localStorage.getItem("elephant::"+e))},I=function(e){for(var t in e)e.hasOwnProperty(t)&&(p[t]="updated_at"!=t?e[t]:new Date(e[t]))},S=function(){b(),localStorage.setItem("elephant::"+s,o(p))},w=function(e){var t=0;t=v.indexOf(e),t>-1&&v.splice(t,1),localStorage.setItem("elephant",o(v)),localStorage.removeItem("elephant::"+e),localStorage.removeItem("elephanto::"+e),lastPostionList=Q(),t=lastPostionList.indexOf(e),t>-1&&lastPostionList.splice(t,1),L(),g=!0,j(),P()},A=function(){D(!0),p.trigger+=1,S()},D=function(e){e&&(p.updated_at=new Date),p.active=e,S()},k=function(){e("#elephanto div.open").off(),e("#elephanto div.open").on("click",function(){m=!m,C()})},O=function(){e("#elephanto span.exit").off(),e("#elephanto span.exit").on("click",function(){e("#elephanto").toggle(),clearInterval(J)})},T=function(){e("#elephanto div.list div.entry div.text").off("click"),e("#elephanto div.list div.entry div.text").on("click",function(){location.href=e(this).data("url")})},R=function(){e("#elephanto div.list div.entry div.remove img").off("click"),e("#elephanto div.list div.entry div.remove img").on("click",function(){w(e(this).data("entry"))})},M=function(){var e=new Date,t=p.updated_at.getTime()/1e3,n=e.getTime()/1e3;Math.round(n-t)>l.activeDuration&&1==p.active&&D(!1)},N=function(){p.favorite?(e("#elephant_favorite_off").removeClass("active"),e("#elephant_favorite_on").addClass("active")):(e("#elephant_favorite_off").addClass("active"),e("#elephant_favorite_on").removeClass("active"))},C=function(){m?(e("#elephanto span.symbol").html("&#8615;"),e("#elephanto div.entry:not(.first)").css("display","flex")):(e("#elephanto span.symbol").html("&#8613;"),e("#elephanto div.entry:not(.first)").css("display","none"))},P=function(){if(h.length>0&&(d||g)){var t="",n=0,a=m?"&#8615;":"&#8613",i=h.length>l.maxDisplayedResult?l.maxDisplayedResult:h.length,o=i>1?l.entryName.several:l.entryName.one,s="",f="",v="",p="";g=!1,d=!1,t+="<div class='open'>",t+="<span class='symbol'>"+a+"</span> ",t+="<span class='text'>"+l.title+" ("+i+" "+o+")</span>",t+="<span class='exit'><img src='"+c+"/open.png' /></span>",t+="</div>",t+="<div class='list'>",e.each(h,function(e,a){if(!(n<l.maxDisplayedResult))return!1;s=r(localStorage.getItem("elephanto::"+a)),f=r(localStorage.getItem("elephant::"+a)),v=0==n?"first":"",p=f.favorite?c+"/favorite-on.png":c+"/favorite-off.png",t+="<div class='entry "+v+"' data-score='"+f.score+"' data-position='"+n+"' data-favorite='"+f.favorite+"'>",t+="<div class='favorite'><img src='"+p+"' /></div>",s.image&&(t+="<div class='image'><img src='"+s.image+"'  /></div>"),s.text&&(t+="<div class='text' data-url='"+s.page+"'>"+s.text+"</div>"),t+="<div class='remove'><img src='"+c+"/remove.png' data-entry='"+a+"' /></div>",t+="</div>",n++}),t+="</div>",e("#elephanto").html(t),m&&C(),T(),k(),O(),R()}0==h.length&&e("#elephanto").html("")},b=function(){var e=0;e+=Math.round(p.time*u.time),e+=Math.round(p.visit*u.visit),e+=Math.round(p.trigger*u.trigger),e+=Math.round(p.scroll*u.scroll),p.score=e,j()},j=function(){var t=Q(),n=(new Array,new Array),a=new Array;h=new Array;var i=0;e.each(v,function(e,t){var i=new Array;i.page=t,i.stats=x(v[e]),i.stats.favorite?n.push(i):a.push(i)}),n.sort(function(e,t){return t.stats.score-e.stats.score}),a.sort(function(e,t){return t.stats.score-e.stats.score}),e.each(n,function(e,t){h[i]=t.page,i++}),e.each(a,function(e,t){h[i]=t.page,i++}),e.each(h,function(e,n){h[e]!==t[e]&&(d=!0)}),L()},L=function(){localStorage.setItem("elephant_position_list",o(h))},Q=function(){return r(localStorage.getItem("elephant_position_list"))};if(function(){return!!e("div#elephant").length}()&&(y()||_(),n(),function(){return-1!==jQuery.inArray(s,v)}()||function(){v.push(s),localStorage.setItem("elephant",o(v)),localStorage.setItem("elephant::"+s,o(p)),f.text=e("#elephant").data("text"),f.image=e("#elephant").data("image"),localStorage.setItem("elephanto::"+s,o(f))}(),function(){var e=r(localStorage.getItem("elephant::"+s));I(e)}(),function(){if(e(l.favoriteTrigger).length>0){var t="",n="",a="";p.favorite?a="active":n="active",t+="<div id='elephant_favorite_off' class='"+n+"'>",t+="<span class='elephant_favorite_off'>"+l.favoriteIcon+"</span>",t+="<span>"+l.favoriteOffText+"</span>",t+="</div>",t+="<div id='elephant_favorite_on' class='"+a+"'>",t+="<span class='elephant_favorite_on'>"+l.favoriteIcon+"</span>",t+="<span>"+l.favoriteOnText+"</span>",t+="</div>",e("#elephant_favorite").html(t)}}(),setInterval(function(){a()},1e3),function(){e(window).scroll(function(e){D(!0),p.scroll+=1,S()})}(),function(){p.visit+=1,D(!0),S()}(),function(){e.each(l.triggers,function(t,n){e(n).on("click",function(){A()})})}(),function(){e(l.favoriteTrigger).on("click",function(){g=!0,i(),S()})}()),function(){return!!e("div#elephanto").length}()){y()||_(),function(){"default"!=l.theme&&e("head").append(e("<link rel='stylesheet' href='"+l.path+"/themes/"+l.theme+"/"+l.theme+".min.css' type='text/css' media='screen' />"))}(),n(),j(),P();var J=setInterval(function(){n(),j(),P()},1e3*l.refreshRender)}}}(jQuery)});