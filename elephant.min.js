$(document).ready(function(){!function(e){e.fn.elephant=function(t){function a(){f=r(localStorage.getItem("elephant"))}function i(){R(),p.active&&(p.time++,I())}function n(){1==p.favorite?(p.favorite=0,I()):(p.favorite=1,A(!0)),b()}function o(e){return JSON.stringify(e)}function r(e){return jQuery.parseJSON(e)}var l=e.extend({triggers:new Array,activeDuration:30,refreshRender:1,maxDisplayedResult:5,title:"Favoris",entryName:{one:"",several:""},favoriteTrigger:"#elephant_favorite",favoriteOffText:"Add to favorites",favoriteOnText:"Remove from favorites",path:"",theme:"default"},t),s=window.location.pathname,c=l.path+"/themes/"+l.theme,v={page:s,text:"",image:""},f=new Array,d="visible",p={time:0,scroll:0,visit:0,trigger:0,favorite:0,updated_at:new Date,active:!0,score:0},h={time:1,scroll:1,visit:10,trigger:10},u=new Array,g=!1,m=!0,y=function(){return null!=localStorage.getItem("elephant")},_=function(){localStorage.setItem("elephant",o(f)),localStorage.setItem("elephant_view",d)},w=function(e){return r(localStorage.getItem("elephant::"+e))},x=function(e){for(var t in e)e.hasOwnProperty(t)&&(p[t]="updated_at"!=t?e[t]:new Date(e[t]))},I=function(){P(),localStorage.setItem("elephant::"+s,o(p))},S=function(e){var t=0;t=f.indexOf(e),t>-1&&f.splice(t,1),localStorage.setItem("elephant",o(f)),localStorage.removeItem("elephant::"+e),localStorage.removeItem("elephanto::"+e),lastPostionList=Q(),t=lastPostionList.indexOf(e),t>-1&&lastPostionList.splice(t,1),L(),m=!0,j(),N()},k=function(){A(!0),p.trigger+=1,I()},A=function(e){e&&(p.updated_at=new Date),p.active=e,I()},D=function(){e("#elephanto div.open").off(),e("#elephanto div.open").on("click",function(){M()})},O=function(){e("#elephanto div.list div.entry div.text").off("click"),e("#elephanto div.list div.entry div.text").on("click",function(){location.href=e(this).data("url")})},T=function(){e("#elephanto div.list div.entry div.remove img").off("click"),e("#elephanto div.list div.entry div.remove img").on("click",function(){S(e(this).data("entry"))})},R=function(){var e=new Date,t=p.updated_at.getTime()/1e3,a=e.getTime()/1e3;Math.round(a-t)>l.activeDuration&&1==p.active&&A(!1)},b=function(){p.favorite?(e("#elephant_favorite_off").removeClass("active"),e("#elephant_favorite_on").addClass("active")):(e("#elephant_favorite_off").addClass("active"),e("#elephant_favorite_on").removeClass("active"))},M=function(){"visible"==d||"reduce"==d?(e("#elephanto div.open div.switch_view img.expand").css("display","none"),e("#elephanto div.open div.switch_view img.reduce").css("display","block"),e("#elephanto div.list").css("display","block"),e("#elephanto div.list div.entry").css("display","flex"),d="expand"):"expand"==d&&(e("#elephanto div.open div.switch_view img.expand").css("display","block"),e("#elephanto div.open div.switch_view img.reduce").css("display","none"),e("#elephanto div.list").toggle(),d="reduce"),localStorage.setItem("elephant_view",d)},N=function(){if(u.length>0&&(g||m)){var t="",a=0,i=u.length>l.maxDisplayedResult?l.maxDisplayedResult:u.length,n=i>1?l.entryName.several:l.entryName.one,o="",s="",v="",f="";m=!1,g=!1,t+="<div class='open'>",t+="<div class='logo'><img src='"+c+"/logo.png' /></div>",t+="<div class='text'>"+l.title+"<span class='count'>"+i+n+"</span></div>",t+="<div class='switch_view'>",t+="<img class='expand' src='"+c+"/open.png' />",t+="<img class='reduce' src='"+c+"/reduce.png' />",t+="</div>",t+="</div>",t+="<div class='list'>",e.each(u,function(e,i){if(!(a<l.maxDisplayedResult))return!1;o=r(localStorage.getItem("elephanto::"+i)),s=r(localStorage.getItem("elephant::"+i)),v=0==a?"first":"",f=s.favorite?c+"/favorite-on.png":c+"/favorite-off.png",t+="<div class='entry "+v+"' data-score='"+s.score+"' data-position='"+a+"' data-favorite='"+s.favorite+"'>",t+="<div class='favorite'><img src='"+f+"' /></div>",o.image&&(t+="<div class='image'><img src='"+o.image+"'  /></div>"),o.text&&(t+="<div class='text' data-url='"+o.page+"'>"+o.text+"</div>"),t+="<div class='remove'><img src='"+c+"/remove.png' data-entry='"+i+"' /></div>",t+="</div>",a++}),t+="</div>",e("#elephanto").html(t),O(),D(),T(),C()}0==u.length&&e("#elephanto").html("")},C=function(){d=localStorage.getItem("elephant_view"),"reduce"==d?e("#elephanto div.list").css("display","none"):"expand"==d&&(e("#elephanto div.list").css("display","block"),e("#elephanto div.list div.entry").css("display","flex"))},P=function(){var e=0;e+=Math.round(p.time*h.time),e+=Math.round(p.visit*h.visit),e+=Math.round(p.trigger*h.trigger),e+=Math.round(p.scroll*h.scroll),p.score=e,j()},j=function(){var t=Q(),a=(new Array,new Array),i=new Array;u=new Array;var n=0;e.each(f,function(e,t){var n=new Array;n.page=t,n.stats=w(f[e]),n.stats.favorite?a.push(n):i.push(n)}),a.sort(function(e,t){return t.stats.score-e.stats.score}),i.sort(function(e,t){return t.stats.score-e.stats.score}),e.each(a,function(e,t){u[n]=t.page,n++}),e.each(i,function(e,t){u[n]=t.page,n++}),e.each(u,function(e,a){u[e]!==t[e]&&(g=!0)}),L()},L=function(){localStorage.setItem("elephant_position_list",o(u))},Q=function(){return r(localStorage.getItem("elephant_position_list"))};if(function(){return!!e("div#elephant").length}()&&(y()||_(),a(),function(){return-1!==jQuery.inArray(s,f)}()||function(){f.push(s),localStorage.setItem("elephant",o(f)),localStorage.setItem("elephant::"+s,o(p)),v.text=e("#elephant").data("text"),v.image=e("#elephant").data("image"),localStorage.setItem("elephanto::"+s,o(v))}(),function(){var e=r(localStorage.getItem("elephant::"+s));x(e)}(),function(){if(e(l.favoriteTrigger).length>0){var t="",a="",i="";p.favorite?i="active":a="active",t+="<div id='elephant_favorite_off' class='"+a+"'>",t+="<span class='elephant_favorite_off'>"+l.favoriteIcon+"</span>",t+="<span>"+l.favoriteOffText+"</span>",t+="</div>",t+="<div id='elephant_favorite_on' class='"+i+"'>",t+="<span class='elephant_favorite_on'>"+l.favoriteIcon+"</span>",t+="<span>"+l.favoriteOnText+"</span>",t+="</div>",e("#elephant_favorite").html(t)}}(),setInterval(function(){i()},1e3),function(){e(window).scroll(function(e){A(!0),p.scroll+=1,I()})}(),function(){p.visit+=1,A(!0),I()}(),function(){e.each(l.triggers,function(t,a){e(a).on("click",function(){k()})})}(),function(){e(l.favoriteTrigger).on("click",function(){m=!0,n(),I()})}()),function(){return!!e("div#elephanto").length}()){y()||_(),function(){e("head").append(e("<link rel='stylesheet' href='"+l.path+"/themes/"+l.theme+"/"+l.theme+".min.css' type='text/css' media='screen' />"))}(),a(),j(),N();setInterval(function(){a(),j(),N()},1e3*l.refreshRender)}}}(jQuery)});